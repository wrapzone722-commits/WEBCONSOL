# üì± iOS –ö–ª–∏–µ–Ω—Ç—Å–∫–æ–µ –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –¥–ª—è AutoDetail Hub
## –ü–æ–ª–Ω—ã–π –ü—Ä–æ–º—Ç –¥–ª—è Cursor AI - –î–µ—Ç–∞–ª—å–Ω–æ–µ –¢–µ—Ö–Ω–∏—á–µ—Å–∫–æ–µ –ó–∞–¥–∞–Ω–∏–µ

---

## üéØ –ê–ù–ê–õ–ò–ó –ü–†–û–ï–ö–¢–ê –ò –ö–û–ù–¢–ï–ö–°–¢

### –ß—Ç–æ —ç—Ç–æ –∑–∞ –ø—Ä–æ–µ–∫—Ç?
**AutoDetail Hub** ‚Äî –ø–æ–ª–Ω–æ—Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π SaaS –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∞–≤—Ç–æ–º–æ–π–∫–∞–º–∏ –∏ –¥–µ—Ç–µ–π–ª–∏–Ω–≥-—Å–µ—Ä–≤–∏—Å–æ–≤.

**–°—Ç—Ä—É–∫—Ç—É—Ä–∞:**
- **Backend:** Node.js/Express —Å SQLite –±–∞–∑–æ–π + S3 –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–π
- **Admin Web:** React SPA –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –±–∏–∑–Ω–µ—Å–æ–º (—É—Å–ª—É–≥–∏, —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ, –ø–µ—Ä—Å–æ–Ω–∞–ª, –ø—Ä–æ—Å–º–æ—Ç—Ä –∑–∞–∫–∞–∑–æ–≤)
- **iOS App (—ç—Ç–æ –≤–∞—à–∞ –∑–∞–¥–∞—á–∞):** Native Swift –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –¥–ª—è **–∫–æ–Ω–µ—á–Ω—ã—Ö –∫–ª–∏–µ–Ω—Ç–æ–≤** (–≤–æ–¥–∏—Ç–µ–ª–µ–π)

### –ß—Ç–æ —É–∂–µ –≥–æ—Ç–æ–≤–æ –Ω–∞ –±—ç–∫–µ–Ω–¥–µ?
‚úÖ –í—Å–µ API endpoints —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã –∏ –≥–æ—Ç–æ–≤—ã  
‚úÖ SQL —Å—Ö–µ–º–∞ —Å —Ç–∞–±–ª–∏—Ü–∞–º–∏: `appointments`, `services`, `staff_members`, `staff_shifts`, `vehicles`, `work_settings`  
‚úÖ S3 —Ö—Ä–∞–Ω–∏–ª–∏—â–µ –¥–ª—è —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–π (work photos –∏ defect photos)  
‚úÖ –°–∏—Å—Ç–µ–º–∞ API –∫–ª—é—á–µ–π –¥–ª—è iOS –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π  
‚úÖ Admin –ø–∞–Ω–µ–ª—å –Ω–∞ React –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏  

### –í–∞—à–∞ –∑–∞–¥–∞—á–∞
–†–∞–∑—Ä–∞–±–æ—Ç–∞—Ç—å **–Ω–∞—Ç–∏–≤–Ω–æ–µ iOS –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ**, –∫–æ—Ç–æ—Ä–æ–µ –ø–æ–∑–≤–æ–ª–∏—Ç –∫–ª–∏–µ–Ω—Ç–∞–º:
1. **–ü–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è** –∫ –º–∞—Å—Ç–µ—Ä—Å–∫–æ–π –ø–æ QR-–∫–æ–¥—É –∏–ª–∏ –∞–¥—Ä–µ—Å—É
2. **–°–æ–∑–¥–∞—Ç—å –ø—Ä–æ—Ñ–∏–ª—å** —Å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π –æ–± –∞–≤—Ç–æ
3. **–ü—Ä–æ—Å–º–æ—Ç—Ä–µ—Ç—å —É—Å–ª—É–≥–∏** —Å —Ü–µ–Ω–∞–º–∏ –∏ –æ–ø–∏—Å–∞–Ω–∏–µ–º
4. **–ó–∞–±—Ä–æ–Ω–∏—Ä–æ–≤–∞—Ç—å –∑–∞–ø–∏—Å—å** –Ω–∞ —É–¥–æ–±–Ω–æ–µ –≤—Ä–µ–º—è
5. **–ó–∞–≥—Ä—É–∑–∏—Ç—å —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏** –∞–≤—Ç–æ –¥–æ/–ø–æ—Å–ª–µ —Ä–∞–±–æ—Ç—ã
6. **–ü–æ–ª—É—á–∞—Ç—å —Å–æ–æ–±—â–µ–Ω–∏—è** –æ—Ç –º–∞—Å—Ç–µ—Ä—Å–∫–æ–π

---

## üîß –¢–ï–ö–£–©–ê–Ø –ê–†–•–ò–¢–ï–ö–¢–£–†–ê BACKEND (–ê–ù–ê–õ–ò–ó)

### API Endpoints –¥–ª—è iOS –∫–ª–∏–µ–Ω—Ç–∞

#### 1. Initialization & Authentication
```
POST /api/ios/init
- –ù–µ—Ç –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ –Ω–∞ –≤—Ö–æ–¥–µ
- –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç: { apiKey: "ios_...", baseUrl: "https://..." }
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è: –ü—Ä–∏ –ø–µ—Ä–≤–æ–º –∑–∞–ø—É—Å–∫–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

GET /api/ios/profile
- Header: X-API-Key
- –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç: UserProfile { id, name, carMake, carPlate, profilePhotoUrl, ... }
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è: –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

POST /api/ios/profile
- Header: X-API-Key
- –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç: { name, carMake, carPlate, profilePhotoUrl }
- –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç: Updated UserProfile
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è: –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ/–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–æ—Ñ–∏–ª—è
```

#### 2. Services (–£—Å–ª—É–≥–∏)
```
GET /api/client/services
- Header: X-API-Key
- –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç: Array<Service>
  Service: {
    id, name, description, priceRub, durationMinutes,
    imageUrl, active, createdAt
  }
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è: –°–ø–∏—Å–æ–∫ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö —É—Å–ª—É–≥

GET /api/client/services/:id
- Header: X-API-Key
- –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç: Single Service detail
```

#### 3. Availability & Booking
```
GET /api/client/availability?date=YYYY-MM-DD&tzOffsetMinutes=VALUE
- Header: X-API-Key
- Query: date (required), serviceId (optional), tzOffsetMinutes (required)
- –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç: Array<AvailabilitySlot>
  AvailabilitySlot: {
    startIso, endIso, startTime, endTime,
    remainingCapacity, totalCapacity, bookedCount, isAvailable
  }
- –í–ê–ñ–ù–û: tzOffsetMinutes = Math.round(TimeZone.current.secondsFromGMT() / 60)
         –î–ª—è UTC+3: -180, –¥–ª—è UTC+0: 0, –¥–ª—è UTC-5: 300

POST /api/client/appointments
- Header: X-API-Key
- Body: {
    startIso, clientName, phone, telegram,
    carMake, carPlate, serviceName, notes
  }
- –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç: Appointment { id, status, createdAt, ... }
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è: –°–æ–∑–¥–∞–Ω–∏–µ –∑–∞–ø–∏—Å–∏ –Ω–∞ —É—Å–ª—É–≥—É

GET /api/client/appointments
- Header: X-API-Key
- –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç: Array<Appointment> –≤—Å–µ—Ö –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

GET /api/client/appointments/:id
- Header: X-API-Key
- –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç: Full appointment details —Å workPhotos –∏ defectPhotos
```

#### 4. Photo Upload (S3)
```
POST /api/uploads/presign
- Header: X-API-Key
- Body: {
    appointmentId, kind: "work"|"defect",
    filename, contentType: "image/jpeg"
  }
- –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç: { uploadUrl, accessUrl, key, ref }
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è: –ü–æ–ª—É—á–µ–Ω–∏–µ S3 presigned URL

PUT {uploadUrl}
- –ù–µ—Ç –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ (URL —É–∂–µ –ø–æ–¥–ø–∏—Å–∞–Ω)
- Body: Binary JPEG image data
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è: –ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–æ—Ç–æ –Ω–∞ S3

POST /api/client/appointments/:id/photos
- Header: X-API-Key
- Body: { kind: "work"|"defect", photoUrls: [...] }
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è: –ü—Ä–∏–≤—è–∑–∫–∞ —Ñ–æ—Ç–æ –∫ –∑–∞–ø–∏—Å–∏
```

#### 5. Messages
```
GET /api/ios/messages
- Header: X-API-Key
- –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç: { messages: Array<Message> }
  Message: { id, text, sentAt, read }

POST /api/ios/messages/:messageId/read
- Header: X-API-Key
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è: –û—Ç–º–µ—Ç–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ –∫–∞–∫ –ø—Ä–æ—á–∏—Ç–∞–Ω–Ω–æ–µ
```

#### 6. Other Client Endpoints
```
GET /api/client/vehicles
- Header: X-API-Key
- –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç: Array<Vehicle> (–º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –¥–ª—è –∏—Å—Ç–æ—Ä–∏–∏ –∞–≤—Ç–æ)

GET /api/client/vehicles/:id
- –î–µ—Ç–∞–ª–∏ —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç–Ω–æ–≥–æ —Å—Ä–µ–¥—Å—Ç–≤–∞
```

### Database Schema (–¥–ª—è –ø–æ–Ω–∏–º–∞–Ω–∏—è)
```sql
appointments (
  id TEXT PRIMARY KEY,
  source TEXT CHECK (source IN ('ios', 'admin')),
  status TEXT CHECK (status IN ('new', 'confirmed', 'in_progress', 'done', 'cancelled')),
  start_iso TEXT,
  end_iso TEXT,
  client_id TEXT,  -- —ç—Ç–æ X-API-Key –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
  client_name TEXT,
  phone TEXT,
  telegram TEXT,
  car_make TEXT,
  car_plate TEXT,
  service_name TEXT,
  notes TEXT,
  work_photos TEXT (JSON –º–∞—Å—Å–∏–≤),
  defect_photos TEXT (JSON –º–∞—Å—Å–∏–≤),
  created_at TEXT,
  updated_at TEXT
)

services (
  id TEXT PRIMARY KEY,
  name TEXT,
  description TEXT,
  price_rub INTEGER,
  duration_minutes INTEGER,
  image_url TEXT,
  active BOOLEAN,
  created_at TEXT,
  updated_at TEXT
)

staff_shifts (
  id TEXT PRIMARY KEY,
  staff_id TEXT,
  date_iso TEXT,
  planned_start TEXT,
  planned_end TEXT,
  actual_start_iso TEXT,
  actual_end_iso TEXT,
  status TEXT,
  notes TEXT,
  created_at TEXT,
  updated_at TEXT
)

work_settings (
  id TEXT PRIMARY KEY,
  settings_json TEXT, -- { slotStepMinutes, posts, bookingWindow, ... }
  updated_at TEXT
)
```

---

## üìê –ê–†–•–ò–¢–ï–ö–¢–£–†–ê iOS –ü–†–ò–õ–û–ñ–ï–ù–ò–Ø

### MVVM + Combine + SwiftUI

```
Project/
‚îú‚îÄ‚îÄ App/
‚îÇ   ‚îú‚îÄ‚îÄ AutoDetailHubApp.swift (entry point)
‚îÇ   ‚îî‚îÄ‚îÄ AppCoordinator.swift (navigation routing)
‚îÇ
‚îú‚îÄ‚îÄ Networking/
‚îÇ   ‚îú‚îÄ‚îÄ APIClient.swift (–±–∞–∑–æ–≤—ã–π HTTP –∫–ª–∏–µ–Ω—Ç)
‚îÇ   ‚îú‚îÄ‚îÄ APIEnvironment.swift (dev/prod URLs)
‚îÇ   ‚îú‚îÄ‚îÄ APIError.swift (error handling)
‚îÇ   ‚îî‚îÄ‚îÄ APIRequest.swift (request builder)
‚îÇ
‚îú‚îÄ‚îÄ Services/
‚îÇ   ‚îú‚îÄ‚îÄ KeychainService.swift (secure API key storage)
‚îÇ   ‚îú‚îÄ‚îÄ AuthService.swift (–∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∏ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è)
‚îÇ   ‚îú‚îÄ‚îÄ AppointmentService.swift (fetch appointments, create booking)
‚îÇ   ‚îú‚îÄ‚îÄ ServiceService.swift (fetch services list)
‚îÇ   ‚îú‚îÄ‚îÄ AvailabilityService.swift (check slots)
‚îÇ   ‚îú‚îÄ‚îÄ PhotoUploadService.swift (S3 integration)
‚îÇ   ‚îú‚îÄ‚îÄ ProfileService.swift (get/update user profile)
‚îÇ   ‚îú‚îÄ‚îÄ MessageService.swift (fetch and mark messages)
‚îÇ   ‚îî‚îÄ‚îÄ LocationService.swift (timezone detection)
‚îÇ
‚îú‚îÄ‚îÄ ViewModels/
‚îÇ   ‚îú‚îÄ‚îÄ RootViewModel.swift (app state: initialized/not)
‚îÇ   ‚îú‚îÄ‚îÄ OnboardingViewModel.swift (setup flow)
‚îÇ   ‚îú‚îÄ‚îÄ HomeViewModel.swift (dashboard)
‚îÇ   ‚îú‚îÄ‚îÄ ServicesViewModel.swift (services list)
‚îÇ   ‚îú‚îÄ‚îÄ BookingViewModel.swift (booking flow)
‚îÇ   ‚îú‚îÄ‚îÄ AppointmentDetailViewModel.swift (single appointment)
‚îÇ   ‚îú‚îÄ‚îÄ ProfileViewModel.swift (user profile)
‚îÇ   ‚îú‚îÄ‚îÄ MessagesViewModel.swift (inbox)
‚îÇ   ‚îî‚îÄ‚îÄ PhotoUploadViewModel.swift (photo upload)
‚îÇ
‚îú‚îÄ‚îÄ Views/
‚îÇ   ‚îú‚îÄ‚îÄ Root/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ RootView.swift (choose: onboarding or main app)
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ LoadingView.swift
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ Onboarding/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ OnboardingContainerView.swift
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ WelcomeScreen.swift
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ QRCodeScannerView.swift
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ ManualURLEntryView.swift
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ ProfileSetupView.swift (name, car, photo)
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ MainApp/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ MainTabView.swift (tab bar controller)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Tabs/
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ HomeTab.swift (dashboard)
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ ServicesTab.swift (—É—Å–ª—É–≥–∏)
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ BookingsTab.swift (–º–æ–∏ –∑–∞–ø–∏—Å–∏)
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ MessagesTab.swift (—Å–æ–æ–±—â–µ–Ω–∏—è)
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ ProfileTab.swift (–ø—Ä–æ—Ñ–∏–ª—å)
‚îÇ   ‚îÇ   ‚îÇ
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Services/
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ ServiceListView.swift
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ ServiceDetailView.swift
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ ServiceCard.swift (reusable)
‚îÇ   ‚îÇ   ‚îÇ
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Booking/
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ BookingFlowView.swift (container)
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ DateSelectionView.swift
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ TimeSlotSelectionView.swift
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ BookingSummaryView.swift
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ BookingConfirmationView.swift
‚îÇ   ‚îÇ   ‚îÇ
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Appointments/
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ AppointmentListView.swift (upcoming + past)
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ AppointmentDetailView.swift
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ PhotoGalleryView.swift (work + defect photos)
‚îÇ   ‚îÇ   ‚îÇ
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Messages/
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ MessageListView.swift
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ MessageDetailView.swift
‚îÇ   ‚îÇ   ‚îÇ
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Profile/
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ ProfileView.swift
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ EditProfileView.swift
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ SettingsView.swift
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ LogoutConfirmationView.swift
‚îÇ   ‚îÇ   ‚îÇ
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ Components/
‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ LoadingOverlay.swift
‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ ErrorBanner.swift
‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ AppointmentCard.swift
‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ ServiceCard.swift
‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ MessageCell.swift
‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ PhotoUploadButton.swift
‚îÇ   ‚îÇ       ‚îî‚îÄ‚îÄ TimeSlotCard.swift
‚îÇ   ‚îÇ
‚îÇ   ‚îî‚îÄ‚îÄ Shared/
‚îÇ       ‚îú‚îÄ‚îÄ NavigationBackButton.swift
‚îÇ       ‚îú‚îÄ‚îÄ EmptyStateView.swift
‚îÇ       ‚îú‚îÄ‚îÄ ErrorAlertView.swift
‚îÇ       ‚îî‚îÄ‚îÄ SuccessAlertView.swift
‚îÇ
‚îú‚îÄ‚îÄ Models/
‚îÇ   ‚îú‚îÄ‚îÄ User.swift (UserProfile)
‚îÇ   ‚îú‚îÄ‚îÄ Service.swift
‚îÇ   ‚îú‚îÄ‚îÄ Appointment.swift
‚îÇ   ‚îú‚îÄ‚îÄ AvailabilitySlot.swift
‚îÇ   ‚îú‚îÄ‚îÄ Photo.swift
‚îÇ   ‚îú‚îÄ‚îÄ Message.swift
‚îÇ   ‚îú‚îÄ‚îÄ Vehicle.swift
‚îÇ   ‚îî‚îÄ‚îÄ APIResponse.swift (generic wrappers)
‚îÇ
‚îú‚îÄ‚îÄ Utilities/
‚îÇ   ‚îú‚îÄ‚îÄ Constants.swift (API URLs, etc.)
‚îÇ   ‚îú‚îÄ‚îÄ Formatters/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ DateFormatter+Extensions.swift
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ NumberFormatter+Extensions.swift
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ CurrencyFormatter.swift
‚îÇ   ‚îú‚îÄ‚îÄ Extensions/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ String+Extensions.swift
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Date+Extensions.swift
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Image+Extensions.swift
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ Color+Extensions.swift
‚îÇ   ‚îú‚îÄ‚îÄ Helpers/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ ImageCompression.swift
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ TimezoneHelper.swift
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ NetworkMonitor.swift
‚îÇ   ‚îî‚îÄ‚îÄ Environment/
‚îÇ       ‚îî‚îÄ‚îÄ EnvironmentVariables.swift (debug settings)
‚îÇ
‚îú‚îÄ‚îÄ Resources/
‚îÇ   ‚îú‚îÄ‚îÄ Assets.xcassets
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Colors/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Images/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ App Icon/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ Launch Screen/
‚îÇ   ‚îú‚îÄ‚îÄ Localizable.strings (RUS/ENG)
‚îÇ   ‚îú‚îÄ‚îÄ Fonts/ (–µ—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –∫–∞—Å—Ç–æ–º–Ω—ã–µ)
‚îÇ   ‚îî‚îÄ‚îÄ PresetImages/ (8-12 —Ñ–æ—Ç–æ –∞–≤—Ç–æ –¥–ª—è –≤—ã–±–æ—Ä–∞)
‚îÇ
‚îî‚îÄ‚îÄ Supporting Files/
    ‚îú‚îÄ‚îÄ Info.plist
    ‚îî‚îÄ‚îÄ Config.xcconfig
```

---

## üîê SECURITY & STORAGE

### API Key Management (CRITICAL)
```swift
// ‚ùå –ù–ò–ö–û–ì–î–ê –Ω–µ –¥–µ–ª–∞–π—Ç–µ —Ç–∞–∫:
UserDefaults.standard.setValue(apiKey, forKey: "apiKey") // UNSAFE!

// ‚úÖ –í–°–ï–ì–î–ê –¥–µ–ª–∞–π—Ç–µ —Ç–∞–∫:
try KeychainService.shared.store(apiKey: apiKey, forKey: "ios_api_key")
```

**–ü–æ—á–µ–º—É Keychain?**
- –ó–∞—â–∏—â–µ–Ω iOS Security Framework
- –ù–µ –¥–æ—Å—Ç—É–ø–µ–Ω –≤ backup iTunes
- –ó–∞—â–∏—â–µ–Ω –æ—Ç reverse engineering
- –£–¥–∞–ª—è–µ—Ç—Å—è –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

### What to Store
- ‚úÖ **API Key** ‚Üí Keychain (SECURE)
- ‚úÖ **Base URL** ‚Üí UserDefaults (PUBLIC)
- ‚úÖ **User ID** ‚Üí Keychain (SECURE)
- ‚úÖ **Device Token** (push) ‚Üí Keychain
- ‚ùå **Password** ‚Üí Never store (don't use password auth)
- ‚ùå **Personal data** ‚Üí Use only during session

### Error Handling for API Key
```swift
// –ù–∞ 401 Unauthorized:
1. –û—á–∏—Å—Ç–∏—Ç—å Keychain
2. –û—á–∏—Å—Ç–∏—Ç—å UserDefaults
3. –ü–æ–∫–∞–∑–∞—Ç—å alert "–°–µ–∞–Ω—Å –∏—Å—Ç—ë–∫"
4. –í–µ—Ä–Ω—É—Ç—å—Å—è –Ω–∞ WelcomeScreen (–ø–µ—Ä–µ–∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è)
```

---

## üìä –û–°–ù–û–í–ù–´–ï –≠–ö–†–ê–ù–´ –ò FLOWS

### Screen 1: Welcome Screen
**–ö–æ–≥–¥–∞ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è:** App start, –µ—Å–ª–∏ –Ω–µ—Ç API key –≤ Keychain

**Elements:**
- App logo
- "–ü–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ –º–∞—Å—Ç–µ—Ä—Å–∫–æ–π" (heading)
- "–û—Ç—Å–∫–∞–Ω–∏—Ä—É–π—Ç–µ QR –∫–æ–¥" button
- "–ò–ª–∏ –≤–≤–µ–¥–∏—Ç–µ –∞–¥—Ä–µ—Å –≤—Ä—É—á–Ω—É—é" button
- Bottom text: "–¢—Ä–µ–±—É–µ—Ç—Å—è –∏–Ω—Ç–µ—Ä–Ω–µ—Ç —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ"

**Actions:**
- Tap "QR Code" ‚Üí –æ—Ç–∫—Ä—ã—Ç—å QRCodeScannerView
- Tap "Manual" ‚Üí –æ—Ç–∫—Ä—ã—Ç—å URLEntryView
- Scan QR ‚Üí extract base_url ‚Üí POST /api/ios/init

---

### Screen 2: QR Code Scanner
**–ß—Ç–æ –æ—Ç—Å–∫–∞–Ω–∏—Ä–æ–≤–∞—Ç—å:**
```json
{
  "apiVersion": 1,
  "name": "AutoDetail Hub",
  "orgName": "My Car Wash",
  "baseUrl": "https://autodetail.example.com",
  "apiKey": "ios_1705767890_abc123def456"
}
```

**Elements:**
- Camera preview
- Scan rectangle overlay
- "–ù–µ –≤–∏–¥–Ω–æ QR –∫–æ–¥–∞?" ‚Üí open "Enter Manually"
- "–û—Ç–º–µ–Ω–∞" button

**Processing:**
1. Scan QR ‚Üí parse JSON
2. Validate baseUrl (HTTPS)
3. Validate apiKey format (starts with "ios_")
4. Store in Keychain
5. Store baseUrl in UserDefaults
6. POST /api/ios/init (if needed)
7. Proceed to ProfileSetupView

---

### Screen 3: Manual URL Entry
**Elements:**
- Text field: "https://..."
- Example: "autodetail.example.com"
- "–ü–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è" button
- "–ù–∞–∑–∞–¥" button

**Validation:**
- URL –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –≤–∞–ª–∏–¥–Ω—ã–π
- –î–æ–±–∞–≤–∏—Ç—å https:// –µ—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∑–∞–±—ã–ª
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å HTTPS (–Ω–µ HTTP)

**Actions:**
1. User enters URL
2. POST /api/ios/init to that URL
3. Get back: { apiKey, baseUrl }
4. Store in Keychain + UserDefaults
5. Show ProfileSetupView

---

### Screen 4: Profile Setup
**When shown:** After successful init, before entering main app

**Elements:**
- Profile photo (tap to select)
- Options: Camera | Photo Library | Preset Images
- Text field: Full Name (required)
- Text field: Car Make (required, with autocomplete: BMW, Toyota, Mercedes, etc.)
- Text field: Car Plate (required)
- "–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å" button (enabled only if all fields valid)

**Car Make Autocomplete Suggestions:**
- BMW, Mercedes, Audi, Volkswagen
- Toyota, Honda, Hyundai, Kia
- Lada, Chevrolet, Ford, Volkswagen
- + allow free text input

**Photo Selection:**
1. **Preset Images**: Show 8-12 default car photos, user selects one
   - ‚úÖ Fast, no upload needed
   - ‚úÖ Recommended for MVP
2. **Camera**: User takes photo
   - Compress to JPEG max 2MB
   - POST /api/uploads/presign
   - PUT to S3
3. **Photo Library**: User picks existing photo
   - Compress, upload same way

**Validation:**
- Name: 2-100 characters
- Car Make: 2-50 characters
- Car Plate: 2-20 characters
- Photo: Selected (required)

**On Submit:**
```
POST /api/ios/profile
{
  "name": "John Doe",
  "carMake": "BMW",
  "carPlate": "ABC123",
  "profilePhotoUrl": "preset:car_1" or "s3:..."
}
```

**Response:** 200 OK ‚Üí Show MainTabView

---

### Screen 5: Home Tab (Dashboard)
**Default tab on app launch**

**Elements:**
```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ –ü—Ä–∏–≤–µ—Ç, John Doe! üëã    ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îÇ
‚îÇ ‚îÇ –°–ª–µ–¥—É—é—â–∞—è –∑–∞–ø–∏—Å—å   ‚îÇ ‚îÇ
‚îÇ ‚îÇ BMW ABC123         ‚îÇ ‚îÇ
‚îÇ ‚îÇ –í—Ç–æ—Ä–Ω–∏–∫, 15:00     ‚îÇ ‚îÇ
‚îÇ ‚îÇ –ü–æ–ª–∏—Ä–æ–≤–∫–∞ –∞–≤—Ç–æ     ‚îÇ ‚îÇ ‚Üê Card that opens AppointmentDetailView
‚îÇ ‚îÇ 2500 ‚ÇΩ             ‚îÇ ‚îÇ
‚îÇ ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ –ë—ã—Å—Ç—Ä—ã–µ –¥–µ–π—Å—Ç–≤–∏—è        ‚îÇ
‚îÇ [–ó–∞–±—Ä–æ–Ω–∏—Ä–æ–≤–∞—Ç—å] [–°–æ–æ–±—â.] ‚îÇ ‚Üê –ö–Ω–æ–ø–∫–∏
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ –ú–æ–∏ —É—Å–ª—É–≥–∏: 3 –¥–æ—Å—Ç—É–ø–Ω–æ ‚îÇ
‚îÇ –í—Å–µ–≥–æ –∑–∞–ø–∏—Å–µ–π: 5        ‚îÇ
‚îÇ –ü–æ—Å–ª–µ–¥–Ω–∏–π –∑–∞–∫–∞–∑: –í—á–µ—Ä–∞  ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

**Data Sources:**
- GET /api/ios/profile (user greeting)
- GET /api/client/appointments (next appointment, total count)
- GET /api/ios/messages (unread count badge)

**Actions:**
- Tap next appointment ‚Üí AppointmentDetailView
- Tap "–ó–∞–±—Ä–æ–Ω–∏—Ä–æ–≤–∞—Ç—å" ‚Üí BookingFlowView
- Tap "Messages" ‚Üí MessagesTab
- Pull to refresh ‚Üí reload all data
- Swipe down ‚Üí refresh

---

### Screen 6: Services Tab
**Browse all available services**

**Elements:**
```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ –ù–∞—à–∏ —É—Å–ª—É–≥–∏             ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îÇ
‚îÇ ‚îÇ [Image]             ‚îÇ ‚îÇ
‚îÇ ‚îÇ –ü–æ–ª–∏—Ä–æ–≤–∫–∞ –∞–≤—Ç–æ      ‚îÇ ‚îÇ
‚îÇ ‚îÇ 2500 ‚ÇΩ ‚Ä¢ 120 –º–∏–Ω—É—Ç  ‚îÇ ‚îÇ
‚îÇ ‚îÇ –ó–∞—â–∏—Ç–∞ –ª–∞–∫–æ–∫—Ä–∞—Å–∫–∏..‚îÇ ‚îÇ
‚îÇ ‚îÇ [–ó–∞–±—Ä–æ–Ω–∏—Ä–æ–≤–∞—Ç—å]     ‚îÇ ‚îÇ ‚Üê ServiceCard
‚îÇ ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îÇ
‚îÇ ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îÇ
‚îÇ ‚îÇ [Image]             ‚îÇ ‚îÇ
‚îÇ ‚îÇ –ß–∏—Å—Ç–∫–∞ —Å–∞–ª–æ–Ω–∞      ‚îÇ ‚îÇ
‚îÇ ‚îÇ 1500 ‚ÇΩ ‚Ä¢ 60 –º–∏–Ω—É—Ç   ‚îÇ ‚îÇ
‚îÇ ‚îÇ [–ó–∞–±—Ä–æ–Ω–∏—Ä–æ–≤–∞—Ç—å]     ‚îÇ ‚îÇ
‚îÇ ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

**Data:**
- GET /api/client/services ‚Üí [Service]
- Cache for 1 hour (save bandwidth)

**Features:**
- Infinite scroll or pagination
- Service images loaded with AsyncImage
- Price formatted: "2 500 ‚ÇΩ"
- Duration formatted: "120 –º–∏–Ω—É—Ç" or "2 —á–∞—Å–∞"
- Tap card ‚Üí ServiceDetailView

---

### Screen 7: Service Detail View
**Full details of one service**

**Elements:**
- Large image at top
- Service name (heading)
- Full description (scrollable)
- Price: 2500 ‚ÇΩ
- Duration: 2 —á–∞—Å–∞ 15 –º–∏–Ω—É—Ç
- Features list (if available)
- "–ó–∞–±—Ä–æ–Ω–∏—Ä–æ–≤–∞—Ç—å —É—Å–ª—É–≥—É" button

**Data:**
- GET /api/client/services/:id

**Actions:**
- Tap "–ó–∞–±—Ä–æ–Ω–∏—Ä–æ–≤–∞—Ç—å" ‚Üí BookingFlowView (with service pre-selected)

---

### Screen 8: Booking Flow (Multi-step)

#### Step 1: Date Selection
**Calendar picker (next 30 days)**
```
–î–∞—Ç–∞ –∑–∞–ø–∏—Å–∏
[‚Üê 15 Jan] [Jun 2024] [Jan 16 ‚Üí]

Su Mo Tu We Th Fr Sa
       1  2  3  4  5
 6  7  8  9 10 11 12
13 14 15 16 17 18 19  ‚Üê Today highlighted
20 21 22 23 24 25 26
27 28 29 30 31

[–í—ã–±—Ä–∞–Ω–æ: 15 Jan]
[–î–∞–ª–µ–µ] button
```

**Rules:**
- Only future dates (today + 30 days)
- Don't show Sundays if closed (from work_settings)
- Show available slots count below each date

**On Select Date:**
- GET /api/client/availability?date=YYYY-MM-DD
- Show loading spinner

#### Step 2: Time Slot Selection
**After date selected, show available times**
```
–í—ã–±—Ä–∞–Ω–Ω—ã–π –¥–µ–Ω—å: –í—Ç–æ—Ä–Ω–∏–∫, 15 —è–Ω–≤–∞—Ä—è

–î–æ—Å—Ç—É–ø–Ω–æ–µ –≤—Ä–µ–º—è:
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ 08:00 - 09:00 ‚úì         ‚îÇ (2/2 –¥–æ—Å—Ç—É–ø–Ω–æ)
‚îÇ –ü–æ–ª–∏—Ä–æ–≤–∫–∞ –∞–≤—Ç–æ          ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚Üê Tap to select
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ 09:00 - 10:00 ‚úó         ‚îÇ (0/2 –ó–ê–ù–Ø–¢–û)
‚îÇ –ü–æ–ª–∏—Ä–æ–≤–∫–∞ –∞–≤—Ç–æ          ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ 10:00 - 11:00 ‚úì         ‚îÇ (1/2 –¥–æ—Å—Ç—É–ø–Ω–æ)
‚îÇ –ü–æ–ª–∏—Ä–æ–≤–∫–∞ –∞–≤—Ç–æ          ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò

[–í—ã–±—Ä–∞—Ç—å] button (enabled only if slot selected)
```

**Data:**
- GET /api/client/availability?date=2024-01-15&tzOffsetMinutes=-180

**Display:**
- startTime: "08:00" (–ª–æ–∫–∞–ª—å–Ω–æ–µ –≤—Ä–µ–º—è, –ù–ï UTC!)
- Capacity: "2/2 –¥–æ—Å—Ç—É–ø–Ω–æ" (remainingCapacity / totalCapacity)
- Show X if fully booked (isAvailable = false)
- Disable click if not available

**On Select Slot:**
- Store selected: startIso, endIso
- Proceed to Summary

#### Step 3: Booking Summary
**Review before confirming**
```
–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –∑–∞–ø–∏—Å–∏

–£—Å–ª—É–≥–∞: –ü–æ–ª–∏—Ä–æ–≤–∫–∞ –∞–≤—Ç–æ
–î–∞—Ç–∞: –í—Ç–æ—Ä–Ω–∏–∫, 15 —è–Ω–≤–∞—Ä—è
–í—Ä–µ–º—è: 08:00 - 09:00 (2 —á–∞—Å–∞)
–¶–µ–Ω–∞: 2500 ‚ÇΩ
–í–∞—à–µ–π –∞–≤—Ç–æ: BMW ABC123

[–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å] [–û—Ç–º–µ–Ω–∞]
```

**Actions:**
- Tap "–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å":
  - POST /api/client/appointments
  - Show loading
  - On success ‚Üí Show ConfirmationView
  - On error ‚Üí Show error alert with retry

#### Step 4: Confirmation
**After booking successful**
```
‚úì –ó–∞–ø–∏—Å—å —Å–æ–∑–¥–∞–Ω–∞!

–ù–æ–º–µ—Ä –∑–∞–ø–∏—Å–∏: APT-12345
–î–∞—Ç–∞: –í—Ç–æ—Ä–Ω–∏–∫, 15 —è–Ω–≤–∞—Ä—è
–í—Ä–µ–º—è: 08:00 - 09:00
–¶–µ–Ω–∞: 2500 ‚ÇΩ

–ß—Ç–æ –¥–∞–ª—å—à–µ:
1. –ü—Ä–∏–µ–∑–∂–∞–π—Ç–µ –∑–∞ 10 –º–∏–Ω—É—Ç –¥–æ –≤—Ä–µ–º–µ–Ω–∏
2. –ù–∞–∑–æ–≤–∏—Ç–µ –Ω–æ–º–µ—Ä –∑–∞–ø–∏—Å–∏
3. –ú—ã –æ—Ç–ø—Ä–∞–≤–∏–º –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ –∑–∞ 1 —á–∞—Å

[–ú–æ–∏ –∑–∞–ø–∏—Å–∏] [–ù–∞ –≥–ª–∞–≤–Ω—É—é]
```

---

### Screen 9: Bookings Tab
**List of all user's appointments**

**Split into sections:**
1. **Upcoming Appointments** (startIso > now)
2. **Past Appointments** (startIso < now)

**Each appointment card shows:**
```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ –ü–æ–ª–∏—Ä–æ–≤–∫–∞ –∞–≤—Ç–æ          ‚îÇ (serviceName)
‚îÇ –í—Ç–æ—Ä–Ω–∏–∫, 15 —è–Ω–≤ ‚Ä¢ 08:00 ‚îÇ (formatted date/time)
‚îÇ BMW ABC123              ‚îÇ (carMake carPlate)
‚îÇ –°—Ç–∞—Ç—É—Å: –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∞    ‚îÇ (status with color: green/yellow/gray/red)
‚îÇ [–î–µ—Ç–∞–ª–∏] button         ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

**Status Colors:**
- new: Yellow (üü°)
- confirmed: Green (üü¢)
- in_progress: Blue (üîµ)
- done: Gray (‚ö™)
- cancelled: Red (üî¥)

**Data:**
- GET /api/client/appointments

**Actions:**
- Tap card ‚Üí AppointmentDetailView
- Pull to refresh
- Empty state if no appointments

---

### Screen 10: Appointment Detail View
**Full details of single appointment**

**Elements:**
```
–ü–æ–ª–∏—Ä–æ–≤–∫–∞ –∞–≤—Ç–æ
‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
–í—Ç–æ—Ä–Ω–∏–∫, 15 —è–Ω–≤–∞—Ä—è 2024

–í—Ä–µ–º—è: 08:00 - 09:00 (2 —á–∞—Å–∞)
–°—Ç–∞—Ç—É—Å: –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∞ ‚úì
–¶–µ–Ω–∞: 2500 ‚ÇΩ
–ù–æ–º–µ—Ä: APT-12345

–í–∞—à–µ –∞–≤—Ç–æ:
BMW ABC123

–ü—Ä–∏–º–µ—á–∞–Ω–∏—è:
"–ù–æ–≤–∞—è –∫—Ä–∞—Å–∫–∞, —Ç—Ä–µ–±—É–µ—Ç –æ—Å–æ–±–æ–≥–æ –≤–Ω–∏–º–∞–Ω–∏—è"

‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
–§–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏ –¥–æ —Ä–∞–±–æ—Ç—ã:
[–ó–∞–≥—Ä—É–∑–∏—Ç—å —Ñ–æ—Ç–æ]
(No photos yet / list of photos)

–§–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏ –ø–æ—Å–ª–µ —Ä–∞–±–æ—Ç—ã:
[–ó–∞–≥—Ä—É–∑–∏—Ç—å —Ñ–æ—Ç–æ]
(No photos yet / list of photos)
```

**Photo Upload Section:**
- Button: "–ó–∞–≥—Ä—É–∑–∏—Ç—å —Ñ–æ—Ç–æ"
- Shows: Camera | Photo Library | Cancel
- On select:
  1. Compress image
  2. POST /api/uploads/presign (with kind: "work" or "defect")
  3. PUT to S3 URL
  4. POST /api/client/appointments/{id}/photos
  5. Show success & reload

**Data:**
- GET /api/client/appointments/:id

**Actions:**
- Tap "–ó–∞–≥—Ä—É–∑–∏—Ç—å —Ñ–æ—Ç–æ" ‚Üí Photo picker
- Tap photo ‚Üí Full screen view
- Tap back ‚Üí Return to list

---

### Screen 11: Messages Tab
**Inbox from car wash**

**Elements:**
```
–°–æ–æ–±—â–µ–Ω–∏—è (3 –Ω–æ–≤—ã—Ö)
‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
[–Ω–æ–≤–æ–µ] –ó–∞–ø–∏—Å—å –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∞!     [√ó]
       "–í–∞—à–∞ –∑–∞–ø–∏—Å—å APT-12345..."
       –°–µ–≥–æ–¥–Ω—è, 10:30

[–Ω–æ–≤–æ–µ] –ù–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ
       "–ó–∞–ø–∏—Å—å —á–µ—Ä–µ–∑ 1 —á–∞—Å"
       –í—Ç–æ—Ä–Ω–∏–∫, 15 —è–Ω–≤, 07:50

[–ø—Ä–æ—á–∏—Ç–∞–Ω–æ] –°–ø–∞—Å–∏–±–æ –∑–∞ –≤–∏–∑–∏—Ç!
       "–ñ–¥—ë–º –≤–∞—Å —Å–Ω–æ–≤–∞"
       –ü–Ω, 14 —è–Ω–≤, 18:00
```

**Features:**
- Unread count badge (number in red circle)
- Mark as read on tap
- Swipe to delete (optional)
- Auto-refresh every 30 seconds

**Data:**
- GET /api/ios/messages
- On message tap: POST /api/ios/messages/{id}/read

**Empty State:**
- "–°–æ–æ–±—â–µ–Ω–∏–π –Ω–µ—Ç"
- "–ó–¥–µ—Å—å –±—É–¥—É—Ç —Å–æ–æ–±—â–µ–Ω–∏—è –æ—Ç –º–∞—Å—Ç–µ—Ä—Å–∫–æ–π"

---

### Screen 12: Profile Tab
**User profile & settings**

**Elements:**
```
–ü–†–û–§–ò–õ–¨

[Profile Photo] ‚Üê Tap to change
John Doe

‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
–ò–ù–§–û–†–ú–ê–¶–ò–Ø –û–ë –ê–í–¢–û

–ú–∞—Ä–∫–∞: BMW
–ù–æ–º–µ—Ä: ABC123
[–ò–∑–º–µ–Ω–∏—Ç—å] button

‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
–ü–†–û–§–ò–õ–¨

–ò–º—è: John Doe
–ù–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞: +79991234567
Telegram: @johndoe
[–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å] button

‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
–ù–ê–°–¢–†–û–ô–ö–ò

–ê–¥—Ä–µ—Å –º–∞—Å—Ç–µ—Ä—Å–∫–æ–π: autodetail.example.com
[–í—ã–±—Ä–∞—Ç—å –¥—Ä—É–≥—É—é –º–∞—Å—Ç–µ—Ä—Å–∫—É—é]

–Ø–∑—ã–∫: –†—É—Å—Å–∫–∏–π
–¢–µ–º–Ω—ã–π —Ä–µ–∂–∏–º: ‚òë –í–∫–ª—é—á–µ–Ω

‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
–ò–ù–§–û–†–ú–ê–¶–ò–Ø

–í–µ—Ä—Å–∏—è: 1.0.1
[–£—Å–ª–æ–≤–∏—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è]
[–ü–æ–ª–∏—Ç–∏–∫–∞ –ø—Ä–∏–≤–∞—Ç–Ω–æ—Å—Ç–∏]
[–û –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏]

‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
[–í—ã–π—Ç–∏ –∏–∑ –∞–∫–∫–∞—É–Ω—Ç–∞]
```

**Edit Profile View (Modal):**
- Name field
- Phone field
- Telegram field
- Car Make field
- Car Plate field
- Photo selection
- Save / Cancel buttons

**Data:**
- GET /api/ios/profile (pre-fill)
- POST /api/ios/profile (on save)

**Logout Actions:**
1. Confirm with alert
2. DELETE from Keychain (API key, user ID)
3. DELETE from UserDefaults (baseUrl)
4. Clear all cached data
5. Return to WelcomeScreen

---

## üîÑ DETAILED BOOKING FLOW (STEP BY STEP)

### Full Booking Process
```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ User taps "–ó–∞–±—Ä–æ–Ω–∏—Ä–æ–≤–∞—Ç—å"        ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
         ‚îÇ
         ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ Show DateSelectionView           ‚îÇ
‚îÇ ‚Ä¢ Calendar (today + 30 days)     ‚îÇ
‚îÇ ‚Ä¢ Fetch availability on date tap ‚îÇ
‚îÇ GET /api/client/availability     ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
         ‚îÇ
         ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ Show TimeSlotSelectionView       ‚îÇ
‚îÇ ‚Ä¢ Parse availability response    ‚îÇ
‚îÇ ‚Ä¢ Convert UTC times to local     ‚îÇ
‚îÇ ‚Ä¢ Show capacity "N/M"            ‚îÇ
‚îÇ ‚Ä¢ User selects slot              ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
         ‚îÇ
         ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ Show BookingSummaryView          ‚îÇ
‚îÇ ‚Ä¢ Display all details            ‚îÇ
‚îÇ ‚Ä¢ User confirms                  ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
         ‚îÇ
         ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ POST /api/client/appointments    ‚îÇ
‚îÇ Body: {                          ‚îÇ
‚îÇ   startIso: "2024-01-15T08:00Z", ‚îÇ
‚îÇ   clientName: "John Doe",        ‚îÇ
‚îÇ   phone: "+79991234567",         ‚îÇ
‚îÇ   telegram: "johndoe",           ‚îÇ
‚îÇ   carMake: "BMW",                ‚îÇ
‚îÇ   carPlate: "ABC123",            ‚îÇ
‚îÇ   serviceName: "–ü–æ–ª–∏—Ä–æ–≤–∫–∞ –∞–≤—Ç–æ", ‚îÇ
‚îÇ   notes: "–ù–æ–≤–∞—è –∫—Ä–∞—Å–∫–∞"          ‚îÇ
‚îÇ }                                ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
         ‚îÇ
         ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ Response: 201 Created            ‚îÇ
‚îÇ {                                ‚îÇ
‚îÇ   id: "APT-12345",               ‚îÇ
‚îÇ   status: "new",                 ‚îÇ
‚îÇ   createdAt: "2024-01-14T10:30Z" ‚îÇ
‚îÇ }                                ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
         ‚îÇ
         ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ Show ConfirmationView            ‚îÇ
‚îÇ ‚Ä¢ Appointment ID                 ‚îÇ
‚îÇ ‚Ä¢ All details                    ‚îÇ
‚îÇ ‚Ä¢ [My Bookings] [Home]           ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### Timezone Handling (CRITICAL!)
```swift
// ‚ùå WRONG: Don't send local time directly
let formatter = DateFormatter()
formatter.dateFormat = "HH:mm"
// This will be interpreted as UTC!

// ‚úÖ CORRECT: Send ISO 8601 UTC time
let iso8601 = ISO8601DateFormatter().string(from: selectedDate)
// "2024-01-15T08:00:00Z"

// When fetching availability:
// ‚úÖ CORRECT: Send timezone offset
let tzOffset = TimeZone.current.secondsFromGMT() / 60
// For UTC+3 (Moscow): -180
// For UTC+0 (GMT): 0
// For UTC-5 (EST): 300

// Response times are UTC (ISO 8601)
// But "startTime" field is already local:
// "startTime": "08:00" (already converted server-side)
```

---

## üì∏ PHOTO UPLOAD COMPLETE FLOW

### Step-by-step photo upload
```
1. User opens AppointmentDetailView
2. Taps "–ó–∞–≥—Ä—É–∑–∏—Ç—å —Ñ–æ—Ç–æ"
   ‚îÇ
   ‚îú‚îÄ "–ö–∞–º–µ—Ä–∞" ‚Üí Open camera
   ‚îú‚îÄ "–ì–∞–ª–µ—Ä–µ—è" ‚Üí Open photo library
   ‚îî‚îÄ "–û—Ç–º–µ–Ω–∞" ‚Üí Close

3. Image selected/captured
   ‚îÇ
   ‚îú‚îÄ Compress to JPEG
   ‚îÇ  ‚îî‚îÄ Max 2MB
   ‚îÇ
   ‚îú‚îÄ POST /api/uploads/presign
   ‚îÇ  ‚îú‚îÄ appointmentId: "APT-12345"
   ‚îÇ  ‚îú‚îÄ kind: "work" (or "defect")
   ‚îÇ  ‚îú‚îÄ filename: "photo_2024_01_15.jpg"
   ‚îÇ  ‚îî‚îÄ contentType: "image/jpeg"
   ‚îÇ
   ‚îú‚îÄ Response: {
   ‚îÇ  ‚îú‚îÄ uploadUrl: "https://s3.example.com/...",
   ‚îÇ  ‚îú‚îÄ key: "appointments/APT-12345/work/photo.jpg",
   ‚îÇ  ‚îî‚îÄ ref: "s3:appointments/APT-12345/work/photo.jpg"
   ‚îÇ  }
   ‚îÇ
   ‚îú‚îÄ PUT {uploadUrl}
   ‚îÇ  ‚îú‚îÄ Content-Type: image/jpeg
   ‚îÇ  ‚îú‚îÄ Body: Binary image data
   ‚îÇ  ‚îî‚îÄ Show progress bar (50%, 80%, 100%)
   ‚îÇ
   ‚îú‚îÄ POST /api/client/appointments/APT-12345/photos
   ‚îÇ  ‚îú‚îÄ kind: "work"
   ‚îÇ  ‚îî‚îÄ photoUrls: ["s3:appointments/APT-12345/work/photo.jpg"]
   ‚îÇ
   ‚îî‚îÄ Reload appointment detail
      ‚îî‚îÄ Photo appears in gallery
```

### Image Compression
```swift
func compressImage(_ image: UIImage, maxSizeMB: CGFloat = 2) -> Data? {
    var compression: CGFloat = 1.0
    var imageData = image.jpegData(compressionQuality: compression)
    
    let maxBytes = Int(maxSizeMB * 1024 * 1024)
    
    while let data = imageData, data.count > maxBytes && compression > 0.1 {
        compression -= 0.1
        imageData = image.jpegData(compressionQuality: compression)
    }
    
    return imageData
}
```

---

## üåê API ERROR HANDLING

### Common Errors and Recovery

#### 401 Unauthorized (Invalid API Key)
```
Scenario: API key expired or invalid
Response: 401 Unauthorized

Recovery:
1. Clear Keychain (delete API key)
2. Clear UserDefaults
3. Show alert: "–°–µ–∞–Ω—Å –∏—Å—Ç—ë–∫. –ü–µ—Ä–µ–ø–æ–¥–∫–ª—é—á–∏—Ç–µ—Å—å."
4. Auto-dismiss and return to WelcomeScreen
```

#### 404 Not Found
```
Scenario: Appointment doesn't exist, service deleted
Response: 404 Not Found

Recovery:
1. Log the error
2. Show user-friendly message: "–î–∞–Ω–Ω—ã–µ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã"
3. Return to previous screen
```

#### 409 Conflict (Time slot taken)
```
Scenario: Another user booked the same slot
Response: 409 Conflict

Recovery:
1. Refresh availability
2. Show: "–≠—Ç–æ –≤—Ä–µ–º—è —Ç–æ–ª—å–∫–æ —á—Ç–æ –∑–∞–±—Ä–æ–Ω–∏—Ä–æ–≤–∞–ª–∏"
3. Return to time slot selection
```

#### 500 Server Error
```
Scenario: Backend crashes or database error
Response: 500 Internal Server Error

Recovery:
1. Show: "–û—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞. –ü–æ–≤—Ç–æ—Ä–∏—Ç–µ –ø–æ–∑–∂–µ."
2. Log error details (for debugging)
3. Offer retry button
4. Auto-retry with exponential backoff
```

#### Network Errors (No Internet)
```
Scenario: No WiFi/cellular connection
Error: Network timeout or no connection

Recovery:
1. Show offline indicator at top: "‚ö†Ô∏è –ù–µ—Ç –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–∞"
2. Disable all API calls
3. Queue requests locally
4. Auto-retry when connection restored
5. Show: "–ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ"
```

#### Request Timeout
```
Scenario: Server takes too long to respond (>30 seconds)
Error: URLSessionError.timedOut

Recovery:
1. Show: "–ò—Å—Ç–µ–∫–ª–æ –≤—Ä–µ–º—è –æ–∂–∏–¥–∞–Ω–∏—è"
2. Offer manual retry
3. Increase timeout for next request (up to 60s)
4. Log for debugging
```

---

## üß™ TESTING STRATEGY

### Unit Tests (20-30 tests)
- [ ] APIClient request building
- [ ] APIClient response parsing
- [ ] KeychainService store/retrieve/delete
- [ ] ImageCompression utility
- [ ] DateFormatting helpers
- [ ] TimezoneOffset calculation
- [ ] URL validation
- [ ] Form validation (name, phone, etc.)

### Integration Tests (15-20 tests)
- [ ] Full onboarding flow (init ‚Üí profile ‚Üí main)
- [ ] Service list fetch + caching
- [ ] Availability fetch with timezone
- [ ] Booking creation end-to-end
- [ ] Photo upload to S3
- [ ] Message retrieval and mark read
- [ ] Profile update
- [ ] Error scenarios (401, 404, 500, timeout)

### UI Tests (10-15 tests)
- [ ] Welcome screen navigation
- [ ] QR code scanner ‚Üí profile setup
- [ ] Manual URL entry validation
- [ ] Service list display
- [ ] Date picker functionality
- [ ] Time slot selection
- [ ] Booking confirmation
- [ ] Photo upload UI
- [ ] Message list refresh
- [ ] Profile edit

### Manual Testing (Critical)
- [ ] Test on iPhone 12 mini (small screen)
- [ ] Test on iPhone 14 Pro Max (large screen)
- [ ] Test landscape orientation
- [ ] Test dark mode
- [ ] Test with VPN/proxy
- [ ] Test with slow network (network throttling)
- [ ] Test offline ‚Üí online transition
- [ ] Test app backgrounding (5 min, 1 hour)
- [ ] Test with expired API key
- [ ] Test booking race condition (slot taken)
- [ ] Test large photo upload (>50MB)

---

## üì¶ DEPENDENCIES (Minimal, Swift Package Manager)

### Required (built-in)
- Foundation
- SwiftUI
- Combine
- Security (Keychain)
- AVFoundation (Camera)
- PhotosUI (Photo Library)

### Recommended Optional
```swift
// QR Code Scanner (use AVFoundation native instead)
// Image Loading
.package(url: "https://github.com/SDWebImage/SDWebImage.git", from: "5.0.0")

// Optional: Use native URLSession, not Alamofire
// Keep dependencies minimal for app size
```

**Recommendation:** Start without third-party deps, add only if necessary.

---

## üöÄ DEVELOPMENT TIMELINE

### Week 1-2: Setup & Onboarding (2 weeks)
**Goal: User can setup profile and enter main app**

- [ ] Xcode project setup (MVVM structure)
- [ ] Package structure created
- [ ] APIClient basic implementation
- [ ] KeychainService implementation
- [ ] Models defined (User, Service, etc.)
- [ ] WelcomeScreen UI
- [ ] QRCodeScannerView (AVFoundation)
- [ ] ManualURLEntryView
- [ ] ProfileSetupView UI
- [ ] POST /api/ios/init integration
- [ ] POST /api/ios/profile integration
- [ ] Navigation flow (RootView logic)
- [ ] Error handling basics
- [ ] Unit tests for services

**Deliverable:** User can scan QR, enter URL, create profile ‚Üí reach MainTabView

**Test:** Run on physical iPhone (simulator isn't enough for camera)

---

### Week 3-4: Services & Booking (2 weeks)
**Goal: Complete booking flow working**

- [ ] HomeTab UI and mock data
- [ ] ServicesTab list view
- [ ] ServiceDetailView
- [ ] GET /api/client/services integration
- [ ] Service image loading (AsyncImage)
- [ ] Date picker implementation
- [ ] GET /api/client/availability integration
- [ ] Timezone offset calculation fix
- [ ] TimeSlotSelection UI
- [ ] BookingSummaryView
- [ ] POST /api/client/appointments
- [ ] BookingConfirmationView
- [ ] BookingsTab (upcoming + past)
- [ ] AppointmentDetailView
- [ ] Integration tests
- [ ] Error handling + retry logic

**Deliverable:** User can browse services, select date/time, complete booking

**Test:** End-to-end booking on physical device + test date/time display

---

### Week 5-6: Photos & Messages (2 weeks)
**Goal: Photo upload and messaging working**

- [ ] Photo upload UI (Camera | Library | Preset)
- [ ] Image compression utility
- [ ] POST /api/uploads/presign integration
- [ ] S3 upload with URLSession
- [ ] Upload progress UI
- [ ] POST /api/client/appointments/{id}/photos
- [ ] Photo gallery display
- [ ] MessagesTab UI
- [ ] GET /api/ios/messages integration
- [ ] POST /api/ios/messages/:id/read
- [ ] Auto-refresh messages (timer)
- [ ] Unread badge implementation
- [ ] Integration tests

**Deliverable:** User can upload photos and receive messages

**Test:** Test photo upload with slow network, multiple files

---

### Week 7: Profile & Polish (1 week)
**Goal: All features complete, ready for polish**

- [ ] ProfileTab implementation
- [ ] Edit profile (modal or separate screen)
- [ ] POST /api/ios/profile (update) integration
- [ ] GET /api/ios/profile refresh
- [ ] Settings screen (change URL, logout)
- [ ] Logout with Keychain cleanup
- [ ] Network monitor (offline indicator)
- [ ] Loading states refactor
- [ ] Empty state screens
- [ ] Error messages refinement
- [ ] Dark mode support
- [ ] Accessibility (VoiceOver)
- [ ] Performance optimization

**Deliverable:** All features polished, ready for testing

**Test:** Full app walkthrough, dark mode, accessibility

---

### Week 8: Testing & Submission (1 week)
**Goal: Ready for App Store**

- [ ] Bug fixes from week 7 testing
- [ ] Unit + integration test coverage
- [ ] Code review + refactoring
- [ ] Performance profiling
- [ ] Memory leak detection
- [ ] Security audit (Keychain, HTTPS)
- [ ] App icons + launch screen
- [ ] Privacy policy written
- [ ] App Store metadata
- [ ] Build + code signing
- [ ] Final testing on multiple devices
- [ ] Submit to App Store

**Deliverable:** App submitted to App Store (or ready to submit)

---

## ‚úÖ SUCCESS CRITERIA

### MVP (Must Have)
- ‚úÖ Scan QR code or enter URL manually
- ‚úÖ Create user profile
- ‚úÖ API key stored securely in Keychain
- ‚úÖ Browse services list
- ‚úÖ Check availability and book appointment
- ‚úÖ View booked appointments
- ‚úÖ Upload photos to appointment
- ‚úÖ Receive messages from car wash
- ‚úÖ Handle all network errors gracefully
- ‚úÖ Works on iPhone 12 mini to iPhone 14 Pro Max
- ‚úÖ Dark mode support
- ‚úÖ Ready for App Store submission

### Nice to Have (v1.1+)
- üì± iPad support
- üìç Location-based car wash search
- üîî Push notifications
- üí≥ In-app payment
- ‚≠ê Ratings & reviews
- üì± Siri Shortcuts
- üåç Multi-language support
- üë• Referral system

---

## üìã PRE-SUBMISSION CHECKLIST

### Code Quality
- [ ] No hardcoded API keys
- [ ] No test credentials left
- [ ] No NSLog or print statements (except errors)
- [ ] No TODO comments (all done)
- [ ] Code properly formatted
- [ ] No unused imports
- [ ] Proper error handling everywhere
- [ ] Memory leak free (Instruments check)

### Security
- [ ] API key only in Keychain
- [ ] HTTPS only (no HTTP except localhost)
- [ ] No password storage
- [ ] Certificate pinning (optional, for production)
- [ ] No sensitive data in logs
- [ ] Privacy policy written

### iOS Requirements
- [ ] Minimum iOS 13.0 target
- [ ] All screens support both orientations
- [ ] Safe area handled correctly
- [ ] Notch/Dynamic Island aware
- [ ] Dark mode fully supported
- [ ] App icons all sizes
- [ ] Launch screen included
- [ ] Permissions in Info.plist:
  - [ ] NSCameraUsageDescription
  - [ ] NSPhotoLibraryUsageDescription
  - [ ] NSPhotoLibraryAddOnlyUsageDescription

### App Store
- [ ] App name (30 chars max)
- [ ] Subtitle (30 chars max)
- [ ] Description (4000 chars max)
- [ ] Keywords
- [ ] Support URL
- [ ] Privacy policy URL
- [ ] Screenshots (5-6 per orientation)
- [ ] Preview video (optional)
- [ ] App category selected
- [ ] Content rating completed
- [ ] EULA (if needed)

### Metadata Examples
```
App Name: AutoDetail Hub

Subtitle: Book car detailing in seconds

Description:
AutoDetail Hub ‚Äî –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è –∞–≤—Ç–æ–º–æ–π–∫–∏ 
–∏ –¥–µ—Ç–µ–π–ª–∏–Ω–≥–∞. –í—ã–±–µ—Ä–∏—Ç–µ –≤—Ä–µ–º—è, –∑–∞–≥—Ä—É–∑–∏—Ç–µ —Ñ–æ—Ç–æ –∞–≤—Ç–æ, –ø–æ–ª—É—á–∞–π—Ç–µ 
–æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –æ –≤–∞—à–µ–π –∑–∞–ø–∏—Å–∏. –ë–æ–ª–µ–µ 500 —Å–∞–ª–æ–Ω–æ–≤ —É–∂–µ –∏—Å–ø–æ–ª—å–∑—É—é—Ç!

Keywords: –∞–≤—Ç–æ–º–æ–π–∫–∞, –¥–µ—Ç–µ–π–ª–∏–Ω–≥, –ø–æ–ª–∏—Ä–æ–≤–∫–∞, –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ, –∞–≤—Ç–æ
```

---

## ü§ù API SUPPORT & COMMUNICATION

### Backend is Ready ‚úÖ
All endpoints tested and working:
- `POST /api/ios/init` ‚úÖ
- `GET /api/ios/profile` ‚úÖ
- `POST /api/ios/profile` ‚úÖ
- `GET /api/client/services` ‚úÖ
- `GET /api/client/availability` ‚úÖ
- `POST /api/client/appointments` ‚úÖ
- `POST /api/uploads/presign` ‚úÖ
- `GET /api/ios/messages` ‚úÖ
- All photo upload endpoints ‚úÖ

### If You Get 401 Errors
1. Verify API key is stored correctly in Keychain
2. Verify X-API-Key header is sent
3. Check API key format (starts with "ios_")
4. Check if API key still valid (not deleted)

### If You Get 400 Errors
1. Verify request body JSON structure
2. Verify timezone offset calculation
3. Verify date format (YYYY-MM-DD)
4. Check required fields are present

### Common Timezone Issues
```swift
// ‚ùå WRONG: Sending local time without timezone info
startIso: "2024-01-15 08:00:00" // Server gets confused!

// ‚úÖ CORRECT: ISO 8601 UTC
startIso: "2024-01-15T08:00:00Z"

// For availability query:
// UTC+3 (Moscow): tzOffsetMinutes = -180
// UTC+0 (London): tzOffsetMinutes = 0
// UTC-5 (NYC): tzOffsetMinutes = 300

let offset = TimeZone.current.secondsFromGMT() / 60
```

---

## üìö CODE EXAMPLES

### APIClient Basic Template
```swift
import Foundation
import Combine

class APIClient {
    static let shared = APIClient()
    
    private let session: URLSession
    private let baseURL: URL
    
    init(baseURL: URL? = nil) {
        self.baseURL = baseURL ?? URL(string: "https://api.example.com")!
        
        let config = URLSessionConfiguration.default
        config.timeoutIntervalForRequest = 30
        config.timeoutIntervalForResource = 60
        self.session = URLSession(configuration: config)
    }
    
    func request<T: Decodable>(
        _ endpoint: String,
        method: String = "GET",
        body: Encodable? = nil,
        apiKey: String? = nil
    ) async throws -> T {
        let url = baseURL.appendingPathComponent(endpoint)
        var request = URLRequest(url: url)
        request.httpMethod = method
        
        if let apiKey = apiKey {
            request.setValue(apiKey, forHTTPHeaderField: "X-API-Key")
        }
        
        if body != nil {
            request.setValue("application/json", forHTTPHeaderField: "Content-Type")
            request.httpBody = try JSONEncoder().encode(body)
        }
        
        let (data, response) = try await session.data(for: request)
        
        guard let httpResponse = response as? HTTPURLResponse else {
            throw APIError.invalidResponse
        }
        
        switch httpResponse.statusCode {
        case 200...299:
            return try JSONDecoder().decode(T.self, from: data)
        case 401:
            throw APIError.unauthorized
        case 404:
            throw APIError.notFound
        case 500...599:
            throw APIError.serverError
        default:
            throw APIError.unknownError
        }
    }
}
```

### KeychainService Template
```swift
import Security
import Foundation

class KeychainService {
    static let shared = KeychainService()
    
    private let service = "com.autodetail.ios"
    
    func store(apiKey: String) throws {
        let data = apiKey.data(using: .utf8)!
        
        let query: [String: Any] = [
            kSecClass as String: kSecClassGenericPassword,
            kSecAttrService as String: service,
            kSecAttrAccount as String: "apiKey",
            kSecValueData as String: data,
            kSecAttrAccessible as String: kSecAttrAccessibleWhenUnlockedThisDeviceOnly
        ]
        
        SecItemDelete(query as CFDictionary)
        let status = SecItemAdd(query as CFDictionary, nil)
        
        if status != errSecSuccess {
            throw KeychainError.storageFailed
        }
    }
    
    func retrieve() throws -> String? {
        let query: [String: Any] = [
            kSecClass as String: kSecClassGenericPassword,
            kSecAttrService as String: service,
            kSecAttrAccount as String: "apiKey",
            kSecReturnData as String: true
        ]
        
        var result: AnyObject?
        let status = SecItemCopyMatching(query as CFDictionary, &result)
        
        if status == errSecSuccess {
            return String(data: result as! Data, encoding: .utf8)
        }
        return nil
    }
    
    func delete() throws {
        let query: [String: Any] = [
            kSecClass as String: kSecClassGenericPassword,
            kSecAttrService as String: service,
            kSecAttrAccount as String: "apiKey"
        ]
        
        SecItemDelete(query as CFDictionary)
    }
}
```

---

## üéØ FINAL REMINDERS

### Architecture Decisions
- Use MVVM + Combine (modern iOS)
- SwiftUI for UI (not UIKit)
- No external dependencies for MVP
- Async/await for networking
- Combine for reactive state

### Performance
- Cache service list (1 hour TTL)
- Lazy load images
- Don't block main thread
- Implement pagination for long lists
- Profile on iPhone 12 mini (slowest)

### Security
- API key in Keychain (NOT UserDefaults)
- HTTPS only
- No logging of sensitive data
- Validate all URLs (HTTPS)
- Clear data on logout

### Testing
- Unit tests for services
- Integration tests for flows
- Manual test on real device (camera!)
- Test all error scenarios
- Test dark mode

### Submission
- Start review process by Week 7
- Budget 1-2 weeks for App Store review
- Have alternative contact in case rejection
- Have privacy policy ready
- Have screenshots and descriptions ready

---

## üöÄ START HERE

1. **Create Xcode Project**
   - iOS, Single View App
   - Swift language
   - SwiftUI interface

2. **Copy This Entire Prompt to Cursor**
   - Paste in "System Prompt" or "Context"
   - Use as reference throughout development

3. **Follow Week-by-Week Plan**
   - Do week 1-2 checklist first
   - Build incrementally
   - Test as you go

4. **Ask Questions**
   - API issues: Check `/api/docs`
   - Backend questions: Ask dev team
   - Architecture questions: Reference MVVM patterns

5. **Iterate Frequently**
   - Commit to git daily
   - Test on real device weekly
   - Get feedback from backend team early

---

**Document Status:** Complete & Production Ready ‚úÖ  
**Last Updated:** January 2024  
**Backend API Version:** 1.0  
**iOS Target:** iOS 13.0+  
**Architecture:** MVVM + Combine + SwiftUI

Good luck! Build something amazing! üéâ
